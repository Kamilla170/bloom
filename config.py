import os
import pytz
import logging

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
BOT_TOKEN = os.getenv("BOT_TOKEN")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
PLANTID_API_KEY = os.getenv("PLANTID_API_KEY")
DATABASE_URL = os.getenv("DATABASE_URL")
WEBHOOK_URL = os.getenv("WEBHOOK_URL")
PORT = int(os.getenv("PORT", 8000))

# –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å
MOSCOW_TZ = pytz.timezone('Europe/Moscow')

# –ú–∞–ø–ø–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ä–∞—Å—Ç–µ–Ω–∏–π
STATE_EMOJI = {
    'healthy': 'üå±',
    'flowering': 'üíê',
    'active_growth': 'üåø',
    'dormancy': 'üò¥',
    'stress': '‚ö†Ô∏è',
    'adaptation': 'üîÑ'
}

STATE_NAMES = {
    'healthy': '–ó–¥–æ—Ä–æ–≤–æ–µ',
    'flowering': '–¶–≤–µ—Ç–µ–Ω–∏–µ',
    'active_growth': '–ê–∫—Ç–∏–≤–Ω—ã–π —Ä–æ—Å—Ç',
    'dormancy': '–ü–µ—Ä–∏–æ–¥ –ø–æ–∫–æ—è',
    'stress': '–°—Ç—Ä–µ—Å—Å/–ë–æ–ª–µ–∑–Ω—å',
    'adaptation': '–ê–¥–∞–ø—Ç–∞—Ü–∏—è'
}

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π
PLANT_IDENTIFICATION_PROMPT = """
–í—ã - —ç–∫—Å–ø–µ—Ä—Ç-–±–æ—Ç–∞–Ω–∏–∫. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é —Ä–∞—Å—Ç–µ–Ω–∏—è –∏ –¥–∞–π—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω—É—é –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.

–í–ê–ñ–ù–û: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –í–ò–î–ù–û –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏. –ï—Å–ª–∏ –ø–æ—á–≤–∞ –Ω–µ –≤–∏–¥–Ω–∞ - –Ω–µ –¥–∞–≤–∞–π—Ç–µ —Å–æ–≤–µ—Ç—ã –ø–æ –ø–æ–ª–∏–≤—É.

–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ:
1. –§–æ—Ä–º—É –∏ —Ç–µ–∫—Å—Ç—É—Ä—É –ª–∏—Å—Ç—å–µ–≤ (–æ–≤–∞–ª—å–Ω—ã–µ/–¥–ª–∏–Ω–Ω—ã–µ/–º—è—Å–∏—Å—Ç—ã–µ/–≥–ª—è–Ω—Ü–µ–≤—ã–µ/–º–∞—Ç–æ–≤—ã–µ)
2. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ª–∏—Å—Ç—å–µ–≤ –Ω–∞ —Å—Ç–µ–±–ª–µ
3. –¶–≤–µ—Ç –∏ –ø—Ä–æ–∂–∏–ª–∫–∏ –ª–∏—Å—Ç—å–µ–≤
4. –§–æ—Ä–º—É —Ä–æ—Å—Ç–∞ —Ä–∞—Å—Ç–µ–Ω–∏—è
5. –í–∏–¥–∏–º—ã–µ —Ü–≤–µ—Ç—ã –∏–ª–∏ –ø–ª–æ–¥—ã
6. –†–∞–∑–º–µ—Ä —Ä–∞—Å—Ç–µ–Ω–∏—è –∏ –≥–æ—Ä—à–∫–∞

–û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø –†–ê–°–¢–ï–ù–ò–Ø (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ):
- healthy (–∑–¥–æ—Ä–æ–≤–æ–µ) - –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç, –∑–¥–æ—Ä–æ–≤—ã–π –≤–∏–¥
- flowering (—Ü–≤–µ—Ç–µ–Ω–∏–µ) - –∞–∫—Ç–∏–≤–Ω–æ–µ —Ü–≤–µ—Ç–µ–Ω–∏–µ –∏–ª–∏ –±—É—Ç–æ–Ω—ã
- active_growth (–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–æ—Å—Ç) - –Ω–æ–≤—ã–µ –ø–æ–±–µ–≥–∏, –±—ã—Å—Ç—Ä—ã–π —Ä–æ—Å—Ç
- dormancy (–ø–µ—Ä–∏–æ–¥ –ø–æ–∫–æ—è) - –∑–∞–º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç, –∑–∏–º–Ω–∏–π –ø–æ–∫–æ–π
- stress (—Å—Ç—Ä–µ—Å—Å/–±–æ–ª–µ–∑–Ω—å) - –∂–µ–ª—Ç—ã–µ –ª–∏—Å—Ç—å—è, –≤—Ä–µ–¥–∏—Ç–µ–ª–∏, –ø—Ä–æ–±–ª–µ–º—ã
- adaptation (–∞–¥–∞–ø—Ç–∞—Ü–∏—è) - –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–∞–¥–∫–∏, —Å–º–µ–Ω—ã –º–µ—Å—Ç–∞

–ü–†–ò–ó–ù–ê–ö–ò –î–õ–Ø –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –°–û–°–¢–û–Ø–ù–ò–Ø:
- –¶–≤–µ—Ç–µ–Ω–∏–µ: –±—É—Ç–æ–Ω—ã, —Ü–≤–µ—Ç—ã, —è—Ä–∫–∏–µ —Ü–≤–µ—Ç–∞
- –ê–∫—Ç–∏–≤–Ω—ã–π —Ä–æ—Å—Ç: –º–æ–ª–æ–¥—ã–µ –ª–∏—Å—Ç—å—è, –Ω–æ–≤—ã–µ –ø–æ–±–µ–≥–∏ —Å–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
- –ü–µ—Ä–∏–æ–¥ –ø–æ–∫–æ—è: –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç, —Å—Ç–∞—Ä—ã–µ –ª–∏—Å—Ç—å—è, –∑–∏–º–Ω–µ–µ –≤—Ä–µ–º—è
- –°—Ç—Ä–µ—Å—Å: –∂–µ–ª—Ç–∏–∑–Ω–∞, –∫–æ—Ä–∏—á–Ω–µ–≤—ã–µ –ø—è—Ç–Ω–∞, –≤—è–ª–æ—Å—Ç—å, –≤—Ä–µ–¥–∏—Ç–µ–ª–∏
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è: –Ω–µ–¥–∞–≤–Ω—è—è –ø–µ—Ä–µ—Å–∞–¥–∫–∞ (–µ—Å–ª–∏ —É–ø–æ–º—è–Ω—É—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)

–ê–ù–ê–õ–ò–ó –ü–û–õ–ò–í–ê - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ—á–≤–∞ –≤–∏–¥–Ω–∞:
- –û—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–∏—Å—Ç—å—è –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —É–≤—è–¥–∞–Ω–∏—è, –∂–µ–ª—Ç–∏–∑–Ω—ã, –∫–æ—Ä–∏—á–Ω–µ–≤—ã—Ö –ø—è—Ç–µ–Ω
- –û—Ü–µ–Ω–∏—Ç–µ —É–ø—Ä—É–≥–æ—Å—Ç—å –∏ —Ç—É—Ä–≥–æ—Ä –ª–∏—Å—Ç—å–µ–≤
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–µ—Ä–µ—É–≤–ª–∞–∂–Ω–µ–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ—Å—É—à–∏–≤–∞–Ω–∏—è
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—á–≤—ã (–µ—Å–ª–∏ –≤–∏–¥–Ω–æ)

–î–∞–π—Ç–µ –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
–†–ê–°–¢–ï–ù–ò–ï: [–¢–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏ –ª–∞—Ç–∏–Ω—Å–∫–æ–º]
–£–í–ï–†–ï–ù–ù–û–°–¢–¨: [–ø—Ä–æ—Ü–µ–Ω—Ç]
–ü–†–ò–ó–ù–ê–ö–ò: [–∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏]
–°–ï–ú–ï–ô–°–¢–í–û: [–±–æ—Ç–∞–Ω–∏—á–µ—Å–∫–æ–µ —Å–µ–º–µ–π—Å—Ç–≤–æ]
–†–û–î–ò–ù–ê: [–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ä–µ–¥–∞]

–¢–ï–ö–£–©–ï–ï_–°–û–°–¢–û–Ø–ù–ò–ï: [–æ–¥–Ω–æ –∏–∑: healthy, flowering, active_growth, dormancy, stress, adaptation]
–ü–†–ò–ß–ò–ù–ê_–°–û–°–¢–û–Ø–ù–ò–Ø: [–ø–æ—á–µ–º—É –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ –≤–∏–¥–Ω–æ –Ω–∞ —Ñ–æ—Ç–æ]
–≠–¢–ê–ü_–†–û–°–¢–ê: [young/mature/old - –º–æ–ª–æ–¥–æ–µ/–≤–∑—Ä–æ—Å–ª–æ–µ/—Å—Ç–∞—Ä–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ]

–°–û–°–¢–û–Ø–ù–ò–ï: [–¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø–æ –ª–∏—Å—Ç—å—è–º]

–ü–û–õ–ò–í_–ê–ù–ê–õ–ò–ó: [–µ—Å–ª–∏ –ø–æ—á–≤–∞ –≤–∏–¥–Ω–∞ - –∞–Ω–∞–ª–∏–∑, –∏–Ω–∞—á–µ: "–ü–æ—á–≤–∞ –Ω–µ –≤–∏–¥–Ω–∞"]
–ü–û–õ–ò–í_–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏]
–ü–û–õ–ò–í_–ò–ù–¢–ï–†–í–ê–õ: [—á–∏—Å–ª–æ –¥–Ω–µ–π: 2-15]

–°–í–ï–¢: [—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ—Å–≤–µ—â–µ–Ω–∏—é]
–¢–ï–ú–ü–ï–†–ê–¢–£–†–ê: [–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω]
–í–õ–ê–ñ–ù–û–°–¢–¨: [—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è]
–ü–û–î–ö–û–†–ú–ö–ê: [—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏]
–ü–ï–†–ï–°–ê–î–ö–ê: [–∫–æ–≥–¥–∞ –ø–µ—Ä–µ—Å–∞–∂–∏–≤–∞—Ç—å]

–ü–†–û–ë–õ–ï–ú–´: [–≤–æ–∑–º–æ–∂–Ω—ã–µ –±–æ–ª–µ–∑–Ω–∏]
–°–û–í–ï–¢: [—Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç –¥–ª—è –¢–ï–ö–£–©–ï–ì–û —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞—Å—Ç–µ–Ω–∏—è]

–î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï_–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò: [–µ—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ù–ï healthy - –¥–∞–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã:
- –î–ª—è flowering: —É–≤–µ–ª–∏—á–∏—Ç—å –ø–æ–ª–∏–≤ –Ω–∞ 2 –¥–Ω—è, –ø–æ–¥–∫–æ—Ä–º–∫–∞ –¥–ª—è —Ü–≤–µ—Ç–µ–Ω–∏—è
- –î–ª—è active_growth: —É–≤–µ–ª–∏—á–∏—Ç—å –ø–æ–¥–∫–æ—Ä–º–∫—É, –±–æ–ª—å—à–µ —Å–≤–µ—Ç–∞
- –î–ª—è dormancy: —É–º–µ–Ω—å—à–∏—Ç—å –ø–æ–ª–∏–≤ –Ω–∞ 5 –¥–Ω–µ–π, —Å–Ω–∏–∑–∏—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
- –î–ª—è stress: —Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã
- –î–ª—è adaptation: —â–∞–¥—è—â–∏–π —Ä–µ–∂–∏–º, –Ω–µ —Ç—Ä–µ–≤–æ–∂–∏—Ç—å]

–ë—É–¥—å—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω—ã–º–∏ –≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
"""

# –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
def validate_config():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö"""
    if not BOT_TOKEN:
        raise ValueError("‚ùå BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
    if not DATABASE_URL:
        raise ValueError("‚ùå DATABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
    
    logger.info("‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞")
    logger.info(f"üîë BOT_TOKEN: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' if BOT_TOKEN else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
    logger.info(f"üîë OPENAI_API_KEY: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' if OPENAI_API_KEY else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
    logger.info(f"üîë PLANTID_API_KEY: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' if PLANTID_API_KEY else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
    logger.info(f"üåê WEBHOOK_URL: {WEBHOOK_URL if WEBHOOK_URL else '‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (polling —Ä–µ–∂–∏–º)'}")
